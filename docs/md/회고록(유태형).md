# 소셜 로그인

### 카카오톡 OAuth2.0의 흐름(프론트엔드 – 백엔드 분리)

1. 프론트엔드에서 카카오 인증서버로 회원 아이디, 비밀번호를 전송하고 Authorization Code를 발급받습니다.
2. 백엔드에게 Authorization Code를 전송합니다.
3. 백엔드에서 Authorization Code를 카카오 인증서버에 전송하고 Access_token, Refresh_token을 반환 받습니다.
4. Access_token을 카카오 리소스 서버에 전달하고 유저 정보를 반환받습니다.
5. refresh_token, 유저 정보를 DB에 저장합니다

### 앱 내에서 카카오 로그인 화면

- 우측 상단의 로그인 -> 일반 회원 -> 카카오 로그인 -> 카카오 로그인 페이지에서 카카오 아이디와 비밀번호를 입력하면 로그인 가능합니다.

# 인증과 인가

•  주의 : 쿠키통신을 위해서는 CORS설정, 쿠키설정이 선행되어야 합니다.

### 인증 흐름

- 사용자로부터 아이디와 비밀번호를 입력 받아 서버의 DB와 비교 후 일치하는 유저정보가 존재하면 Access_token과 Refresh_token을 쿠키에 담아 사용자의 브라우저에게 전달합니다.

### 인증 성공 시

- 카카오가 백엔드로 백엔드가 브라우저에게로 준 Access_token과 Refresh_token을 쿠키속에 담아 사용자의 브라우저에게 전달합니다.

### 인가

- 사용자가 리소스 권한 요청 마다 로직 실행 전에 어떤 방법으로 로그인한 회원 인지, access_token또는 refresh_token이 유효한지 가능한 지 확인합니다.
1. 클라이언트가 서버에게 Access_token과 Refresh_token을 쿠키에 담아 전달합니다.
2. 서버가 쿠키의 Access_token이 유효한 값인지 검증합니다.

2-1. Access_token이 휴효하지 않다면 Refresh_token이 유효한지 검증하고, Refresh_token이 유효하면 Access_token을 재발급, 유요하지 않다면 허가를 주지 않습니다.

3-1. Access_token이나 Refresh_token 둘 중 하나라도 유효하면 로그인에 성공합니다.

3-2. Access_token, Refresh_token 둘 다 무효하면 로그인에 실패합니다.

# 이메일 인증

1. 사용자가 비밀번호를 잊어버렸거나 제3자가 임의로 수정한 경우
2. 사용자가 프론트엔드에게 이메일 주소를 입력합니다.

2., 프론트엔드에서 백엔드로 이메일 주소를 전달합니다.

1. 백엔드에서 인증코드를 DB에 저장한 뒤 해당 이메일로 발송합니다.
2. 사용자가 해당 이메일의 수신함에서 인증코드를 확인합니다.
3. 사용자가 프론트엔드로 인증코드를 전달합니다.
4. 프론트엔드가 백엔드로 인증코드를 전달합니다.
5. DB에 저장된 인증코드와 프론트엔드로부터 받은 인증코드를 검증합니다.
6. 프론트엔드에게 인증코드 검증 여부를 되돌려줍니다. (새로운 비밀번호 받을 지, 틀렸는 지)
7. 인증코드가 맞다면 프론트엔드가 새로운 비밀번호를 입력 받아 백엔드로 전달합니다.
8. 백엔드에서 새로운 비밀번호를 DB에 저장합니다.

### 실제 회원에게 발송된 이메일

- 111111 ~ 999999 사이의 난수 발송

# 이미지 업로드

### 아마존 S3 버킷

- 버킷 안에서 키(이름) – 값(데이터) 쌍으로 이루어져 있음을 확인할 수 있습니다.

### 스프링 부트에서 저장 방법

- 스프링 부트에서 제공하는 연결 정보 등이 내장되어 있는 AmazonS3빈 객체를 사용합니다.
- putObject()메서드로 데이터를 입력하거나 수정하는 것이 가능하고, deleteObject로 삭제하는 것이 가능합니다.
- 프론트엔드에서도 사용할 수 있도록 이미지의 저장위치를 getUrl()메서드를 통해 반환 받습니다.

# 회고 블로그

<https://velog.io/@ds02168/series/%EC%95%BC-%ED%94%BD%EC%97%85%ED%95%B4>
